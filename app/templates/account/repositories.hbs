{{! FIXME what is the future for this? }}
{{#unless features.enterpriseVersion}}
  {{#unless features.proVersion}}
    <p class="text-medium">We're only showing your public repositories. You can find your private projects on <a href="https://travis-ci.com" title="travis-ci.com">travis-ci.com</a>.</p>
  {{/unless}}
{{/unless}}

{{#if showGitHubApps}}
  {{#if hasGitHubAppsInstallation}}
    <div id="github-apps-repositories">
      <header class='space-between' data-test-github-apps-integration-header>
        <h2>GitHub Apps Integration</h2>
        {{#external-link-to href=githubAppsManagementURL}}
          <span class='inner-underline'>Manage on GitHub</span>
          {{svg-jar 'icon-external-link' class='icon'}}
        {{/external-link-to}}
      </header>
      {{#repository-filter
        repositories=model.notLockedGithubAppsRepositories
        queryFunction=(action 'filterQuery') as |filter| }}
        {{#if model.notLockedGithubAppsRepositories.length}}
          {{#component filter.form as |form|}}
            {{#if features.repositoryFiltering}}
              <div class="not-locked-profile-repositories-filter">
                {{component form.searchField
                  placeholder="Filter GitHub Apps repositories"
                  title="Filter GitHub Apps repositories"
                }}
              </div>
            {{/if}}
          {{/component}}
        {{/if}}
        <div>
          {{#if filter.isLoading}}
            {{loading-indicator}}
          {{else}}
            <ul class="profile-repositorylist" id='not-locked-github-apps-repositories'>
              {{#each filter.repositories as |repository|}}
                {{github-apps-repository
                  repository=repository
                  slug=(compute filter.computeSlug repository.slug filter.isFiltering filter.query)}}
              {{else}}
                {{#if filter.isFiltering}}
                  <li class="no-results">Sorry, no results found.</li>
                {{else}}
                  <li>Sorry, it seems like we couldn't find any repositories you have access to on GitHub. FIXME??</li>
                {{/if}}
              {{/each}}
            </ul>
          {{/if}}
        </div>
        {{#unless filter.isFiltering}}
          {{pagination-navigation collection=model.notLockedGithubAppsRepositories route="account.repositories" queryParam='apps-page' inner=6 outer=2}}
        {{/unless}}
      {{/repository-filter}}
      {{#if model.lockedGithubAppsRepositories}}
        <p class="notice-banner--yellow iconned">
          {{svg-jar 'icon-megaphone' class='icon icon-megaphone'}}
          <span class="label-align">
            These repositories cannot be migrated because they are active on travis-ci.org.<br/>
            Please <a href="https://docs.travis-ci.com/">refer to our docs</a> for more information.
          </span>
        </p>
        <ul class="profile-repositorylist" id='locked-github-apps-repositories'>
          {{#each model.lockedGithubAppsRepositories as |repository|}}
            {{github-apps-repository repository=repository slug=repository.slug}}
          {{/each}}
        </ul>
      {{/if}}
    </div>
  {{else}}
    <div id='github-apps-invitation'>
      <h2>GitHub Apps Integration</h2>
      <p>The Travis CI GitHub integration provides enhanced security, X, and supports both <strong>private and open source</strong> repositories.</p>
      <a class='button' href='{{githubAppsActivationURL}}'>
        {{svg-jar 'icon-migrate' class='icon'}} Activate GitHub Apps Integration
      </a>
    </div>
  {{/if}}
{{/if}}

{{#if (or sortedRepositories (not showGitHubApps))}}
  <header class='legacy-services-integration'>
    <h2>Legacy Services Integration <div class="badge deprecated square">Deprecated</div></h2>
    <button class='button' type='button' onclick={{perform migrate}} data-test-migrate-github-apps>
      {{#if migrate.isRunning}}
        {{loading-indicator id="github-apps-migrate-loading" class="loading-indicator--white"}}
      {{else}}
        {{svg-jar 'icon-migrate' class='icon'}}
      {{/if}}
      Migrate to GitHub Apps
    </button>
  </header>
  {{#repository-filter
    repositories=sortedRepositories
    queryFunction=(action 'filterQuery') as |filter| }}
    {{#if sortedRepositories.length}}
      {{#component filter.form as |form|}}
        {{#if features.repositoryFiltering}}
          <div class="profile-repositories-filter">
            {{component form.searchField
              placeholder="Filter repositories"
              title="Filter repositories"
            }}
          </div>
        {{/if}}
      {{/component}}
    {{/if}}
    <div id="administerable-repositories">
      {{#if filter.isLoading}}
        {{loading-indicator}}
      {{else}}
        <ul class="profile-repositorylist">
          {{#each filter.repositories as |repository|}}
            {{repository-status-toggle
            repository=repository
            slug=(compute filter.computeSlug repository.slug filter.isFiltering filter.query)
            }}
          {{else}}
            {{#if filter.isFiltering}}
              <li class="no-results">Sorry, no results found.</li>
            {{else}}
              <li>Sorry, it seems like we couldn't find any repositories you have access to on GitHub.</li>
            {{/if}}
          {{/each}}
        </ul>
      {{/if}}
    </div>
    {{#unless filter.isFiltering}}
      {{pagination-navigation collection=model.deprecated route="account.repositories" inner=6 outer=2}}
    {{/unless}}
  {{/repository-filter}}
{{/if}}
